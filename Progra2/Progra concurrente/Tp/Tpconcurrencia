programa Tpconcurrencia
areas
  areaC : AreaC(1,60,100,80)
  areaG : AreaPC(1,50,100,50)
  areaD : AreaPC(100,100,100,100)
  areaI1 : AreaP(2,2,2,2)
  areaI2 : AreaP(3,3,3,3)
  areaI3 : AreaP(4,4,4,4)
  areaJefe : AreaP(1,1,1,1)
robots
  robot tipo1
  variables
    empezarCa: numero
    TotalF: numero
    TotalP: numero
    quiensoy: numero
    ganadorf: numero
    ganadorp: numero
    bolsa: numero
    iniavca:numero
    av:numero
  comenzar
    RecibirMensaje(iniavca,robotjefe)
    bolsa:=0
    RecibirMensaje(quiensoy,robotjefe)
    EnviarMensaje(quiensoy, robotjefe)
    RecibirMensaje(empezarCa,robotjefe)
    BloquearEsquina(1,empezarCa)
    Pos(1,empezarCa)
    derecha
    TotalF:=0
    TotalP:=0
    repetir 99
      av:=PosAv
      mientras HayFlorEnLaEsquina
        tomarFlor
        TotalF:=TotalF+1
      mientras HayPapelEnLaEsquina
        tomarPapel
        TotalP:=TotalP+1
      BloquearEsquina(av+1,empezarCa)
      mover
      LiberarEsquina(av,empezarCa)
    mientras HayFlorEnLaEsquina
      tomarFlor
      TotalF:=TotalF+1
    mientras HayPapelEnLaEsquina
      tomarPapel
      TotalP:=TotalP+1
    Pos(iniavca,iniavca)
    LiberarEsquina(100,empezarCa)
    EnviarMensaje(quiensoy,robotjefe)
    EnviarMensaje(TotalF,robotjefe)
    EnviarMensaje(TotalP,robotjefe)
    RecibirMensaje(ganadorf,robotjefe)
    RecibirMensaje(ganadorp,robotjefe)
    si (quiensoy=ganadorf) | (quiensoy=ganadorp)
      si (quiensoy=ganadorf)
        BloquearEsquina(1,50)
        Pos(1,50)
        mientras (HayFlorEnLaBolsa) & (PosAv<100)
          av:=PosAv
          depositarFlor
          BloquearEsquina(av+1,50)
          mover
          LiberarEsquina(av,50)
        si HayFlorEnLaBolsa
          depositarFlor
        Pos(iniavca,iniavca)
        LiberarEsquina(PosAv,50) 
      si (quiensoy=ganadorp)
        BloquearEsquina(1,50)
        Pos(1,50)
        mientras (HayPapelEnLaBolsa) & (PosAv<100)
          av:=PosAv
          depositarPapel
          BloquearEsquina(av+1,50)
          mover
          LiberarEsquina(av,50)
        si HayPapelEnLaBolsa
          depositarPapel
        Pos(iniavca,iniavca)
        LiberarEsquina(PosAv,50)
    sino
      bolsa:=TotalF+TotalP
      Informar(bolsa)
      si (bolsa<>0)
        BloquearEsquina(100,100)
        Pos(100,100)
        mientras HayFlorEnLaBolsa
          depositarFlor
        mientras HayPapelEnLaBolsa
          depositarPapel
        Pos(iniavca,iniavca)
        LiberarEsquina(100,100)
  fin
  robot tipo2
  variables
    papeles: numero
    flores:numero
    quiensos:numero
    maxf:numero
    juegaf:numero
    maxp:numero
    juegap:numero
    Calle:numero
  comenzar
    EnviarMensaje(2,robot1)
    EnviarMensaje(3,robot2)
    EnviarMensaje(4,robot3)
    maxf:=0
    maxp:=0
    EnviarMensaje(1,robot1)
    EnviarMensaje(2,robot2)
    EnviarMensaje(3,robot3)
    repetir 3
      Random(Calle,60,80)
      RecibirMensaje(quiensos,*)
      si (quiensos=1)      
        EnviarMensaje(Calle, robot1)
      sino
        si (quiensos=2)
          EnviarMensaje(Calle, robot2)
        sino
          si (quiensos=3) 
            EnviarMensaje(Calle, robot3) 
    repetir 3
      RecibirMensaje(quiensos,*)
      si (quiensos=1)
        RecibirMensaje(flores,robot1)
        RecibirMensaje(papeles,robot1)
      sino
        si (quiensos=2)
          RecibirMensaje(flores,robot2)
          RecibirMensaje(papeles,robot2)
        sino
          si (quiensos=3)  
            RecibirMensaje(flores,robot3)
            RecibirMensaje(papeles,robot3)
      si (maxf<=flores)
        maxf:=flores
        juegaf:=quiensos
      si (maxp<=papeles)
        maxp:=papeles
        juegap:=quiensos
    EnviarMensaje(juegaf,robot1)
    EnviarMensaje(juegaf,robot2)
    EnviarMensaje(juegaf,robot3)
    EnviarMensaje(juegap,robot1)
    EnviarMensaje(juegap,robot2)
    EnviarMensaje(juegap,robot3)
  fin
variables
  robot1: tipo1
  robot2: tipo1
  robot3: tipo1
  robotjefe: tipo2
comenzar
  AsignarArea(robotjefe, areaJefe)
  AsignarArea(robot1, areaC)
  AsignarArea(robot2, areaC)
  AsignarArea(robot3, areaC)
  AsignarArea(robot1, areaG)
  AsignarArea(robot2, areaG)
  AsignarArea(robot3, areaG)
  AsignarArea(robot1, areaI1)
  AsignarArea(robot2, areaI2)
  AsignarArea(robot3, areaI3)
  AsignarArea(robot1, areaD)
  AsignarArea(robot2, areaD)
  AsignarArea(robot3, areaD)
  Iniciar(robotjefe, 1, 1)
  Iniciar(robot1, 2, 2)
  Iniciar(robot2, 3, 3)
  Iniciar(robot3, 4, 4)
fin 

