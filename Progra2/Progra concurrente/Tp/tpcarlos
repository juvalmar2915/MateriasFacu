programa ej4clase3
procesos
  proceso tomarFyP (ES flores:numero; ES papeles:numero)
  comenzar
    mientras HayFlorEnLaEsquina
      tomarFlor
      flores:=flores+1
    mientras HayPapelEnLaEsquina
      tomarPapel
      papeles:=papeles+1
  fin
areas
  areaPC1 : AreaPC(1,60,100,80)
  areaPC2 : AreaPC(1,50,100,50)
  areaPC3 : AreaPC(100,100,100,100)
  casaJefe : AreaP(1,1,1,1)
  casaR1 : AreaP(2,2,2,2)
  casaR2 : AreaP(3,3,3,3)
  casaR3 : AreaP(4,4,4,4)
robots
  robot tipo1
  variables
    CF: numero
    CP: numero
    empezarCa: numero
    quiensoy: numero
    aux:numero
    aux2:numero
    auxpost:numero
    masF: numero
    masP: numero
    RmasF: numero
    RmasP: numero
  comenzar
    RecibirMensaje(quiensoy,robotjefe)
    RecibirMensaje(empezarCa,robotjefe)
    aux:=quiensoy+1
    BloquearEsquina(1, empezarCa)
    Pos(1,empezarCa)
    derecha
    CF:= 0
    CP:= 0
    repetir 99
      tomarFyP(CF,CP)
      aux2:=PosAv + 1
      BloquearEsquina(aux2, empezarCa)
      mover
      aux2:=PosAv - 1
      LiberarEsquina(aux2,empezarCa)
    tomarFyP(CF,CP)
    Pos(aux,aux)
    LiberarEsquina(100, empezarCa)
    EnviarMensaje(quiensoy, robotjefe)
    EnviarMensaje(CF, robotjefe)
    EnviarMensaje(CP, robotjefe)
    RecibirMensaje(RmasF,robotjefe)
    RecibirMensaje(RmasP,robotjefe)
    si ((RmasF=quiensoy) | (RmasP=quiensoy))
      si ((RmasF=quiensoy) & (RmasP=quiensoy))
        Pos(1,50)
        repetir 99
          si HayFlorEnLaBolsa
            depositarFlor
          si HayPapelEnLaEsquina
            depositarPapel
          mover
        si HayFlorEnLaBolsa
          depositarFlor
        si HayPapelEnLaBolsa
          depositarPapel
      sino
        BloquearEsquina(1,50)
        Pos(1,50)
        si RmasF=quiensoy
          repetir 99
            si HayFlorEnLaBolsa
              depositarFlor
            aux2:=PosAv + 1
            BloquearEsquina(aux2,50)
            mover
            aux2:=PosAv - 1
            LiberarEsquina(aux2,50)
          si HayFlorEnLaBolsa
            depositarFlor
        sino
          repetir 99
            si HayPapelEnLaBolsa
              depositarPapel
            aux2:=PosAv + 1
            BloquearEsquina(aux2,50)
            mover
            aux2:=PosAv - 1
            LiberarEsquina(aux2,50)
          si HayPapelEnLaBolsa
            depositarPapel
        Pos(aux,aux)
        LiberarEsquina(100,50)
    sino
      Informar(~((CF=0) | (CP=0)))
      si ~(CF=0 | CP=0)
        BloquearEsquina(100,100)
        Pos(100,100)
        repetir CF
          depositarFlor
        repetir CP
          depositarPapel
        Pos(aux,aux)
        LiberarEsquina(100,100)
  fin
  robot tipo2
  variables
    calle:numero
    flores:numero
    papeles:numero
    maxF:numero
    maxP:numero
    RmaxF:numero
    RmaxP:numero
    quiensos:numero
  comenzar
    EnviarMensaje(1, robot1)
    EnviarMensaje(2, robot2)
    EnviarMensaje(3, robot3)
    Random(calle, 60, 80)
    EnviarMensaje(calle,robot1)
    Random (calle, 60, 80)
    EnviarMensaje(calle,robot2)
    Random(calle, 60, 80)
    EnviarMensaje(calle,robot3)
    repetir 3
      RecibirMensaje(quiensos,*)
      si (quiensos=1)
        RecibirMensaje(flores,robot1)
        RecibirMensaje(papeles,robot1)
      sino
        si (quiensos=2)
          RecibirMensaje(flores,robot2)
          RecibirMensaje(papeles,robot2)
        sino
          RecibirMensaje(flores,robot3)
          RecibirMensaje(papeles,robot3)
      si (maxF<=flores)
        maxF:=flores
        RmaxF:=quiensos
      si (maxP<=papeles)
        maxP:=papeles
        RmaxP:=quiensos
    EnviarMensaje(RmaxF,robot1)
    EnviarMensaje(RmaxF,robot2)
    EnviarMensaje(RmaxF,robot3)
    EnviarMensaje(RmaxP,robot1)
    EnviarMensaje(RmaxP,robot2)
    EnviarMensaje(RmaxP,robot3)
  fin
variables
  robot1: tipo1
  robot2: tipo1
  robot3: tipo1
  robotjefe: tipo2
comenzar
  AsignarArea(robotjefe, casaJefe)
  AsignarArea(robot1, casaR1)
  AsignarArea(robot2, casaR2)
  AsignarArea(robot3, casaR3)
  AsignarArea(robot1, areaPC1)
  AsignarArea(robot2, areaPC1)
  AsignarArea(robot3, areaPC1)
  AsignarArea(robot1, areaPC2)
  AsignarArea(robot2, areaPC2)
  AsignarArea(robot3, areaPC2)
  AsignarArea(robot1, areaPC3)
  AsignarArea(robot2, areaPC3)
  AsignarArea(robot3, areaPC3)
  Iniciar(robotjefe, 1, 1)
  Iniciar(robot1, 2, 2)
  Iniciar(robot2, 3, 3)
  Iniciar(robot3, 4, 4)
fin
