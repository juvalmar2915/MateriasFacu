TIMER EQU 10H
PIC EQU 20H
EOI EQU 20H
N_F10 EQU 10
N_CLK EQU 11

ORG 40
IP_F10 DW RUT_F10
ORG 44
IP_CLK DW RUT_CLK

ORG 1000H
SEG DB 30H
    DB 30H
FIN DB ?

ORG 3000H
RUT_F10: CLI
PUSH AX
CMP CL, 01H
JZ ESTAPAUSA
MOV CL, 01H ; LE AVISO QUE PAUSE EL PARTIDO
MOV AL, 0FEH ; LE INDICO A IMR QUE ENMASCARE TODOS LAS INTERRUPCIONES MENOS INT 0
OUT PIC+1, AL
JMP TERMINAINS 
ESTAPAUSA: MOV AL, 0 ; VUELVO A INICIALIZAR EL CONTADOR
OUT TIMER, AL
MOV CL, 00H ;LE AVISO QUE NO ESTE MAS EN PAUSA AL REGISTRO
MOV AL, 0FCH
OUT PIC+1, AL ; LE INDICO A IMR QUE ENMASCARE TODOS LAS INTERRUPCIONES MENOS INT 0 Y INT 1
TERMINAINS: STI
MOV AL, EOI
OUT EOI, AL
POP AX
IRET

RUT_CLK: PUSH AX
INC SEG+1
CMP SEG+1, 3AH
JNZ RESET
MOV SEG+1, 30H
INC SEG
CMP SEG, 33H
JNZ RESET
INT 0  ; SI LLEGO A 30 SEGUNDOS TERMINO EL PROGRAMA
RESET: MOV AL, 02H ; IMPRIME
INT 7
MOV AL, 0
OUT TIMER, AL
MOV AL, EOI
OUT PIC, AL
POP AX
IRET

ORG 2000H
CLI
MOV AL, 0FEH ; ENMASCARO TODAS LAS INTERRUPCIONES MENOS INT 0 YA QUE TIENE QUE DETENERSE AL APRETAR F10 PARA EMPEZAR
OUT PIC+1, AL ; IMR
MOV AL, N_F10
OUT PIC+4, AL ; INT0
MOV AL, 1
OUT TIMER+1, AL ; COMP
MOV AL, 0
OUT TIMER, AL ; CONT
MOV AL, N_CLK
OUT PIC+5, AL ; INT1
MOV BX, OFFSET SEG
MOV AL, OFFSET FIN-OFFSET SEG
MOV CL, 01H ; REGISTRO DONDE GUARDO SI ESTA EN PAUSA EL PARTIDO
STI
LAZO: JMP LAZO
END
